"use strict";angular.module("justVoteApp",["ngAnimate","ngCookies","ngRoute","firebase","ui.bootstrap"]).run(["$rootScope","$location",function(a,b){a.$on("$routeChangeError",function(a,c,d,e){"AUTH_REQUIRED"===e&&b.path("/login")})}]).config(["$routeProvider",function(a){a.when("/register",{templateUrl:"views/register.html",controller:"RegisterCtrl",controllerAs:"register"}).when("/login",{templateUrl:"views/login.html",controller:"MainCtrl",controllerAs:"main"}).when("/list",{templateUrl:"views/list.html",controller:"ListCtrl",controllerAs:"list",resolve:{initData:["Auth","Vote","$q",function(a,b,c){var d=a.auth.$requireAuth(),e=b.read();return c.all([d,e]).then(function(a){return{currentAuth:a[0],listData:a[1]}})}]}}).when("/item/:id",{templateUrl:"views/item.html",controller:"ItemCtrl",controllerAs:"item",resolve:{initData:["Auth","History","$route","$q",function(a,b,c,d){var e,f=a.auth.$requireAuth(),g=b.ref,h=c.current.params.id,i=d.defer();return d.when(f).then(function(a){e=a,g.child(e.uid).once("value",function(a){var b=a.val();angular.forEach(b,function(a){a.id==h&&i.resolve({exist:!0,currentAuth:e})}),i.resolve({exist:!1,currentAuth:e})})}),i.promise}]}}).when("/create",{templateUrl:"views/create.html",controller:"CreateCtrl",controllerAs:"create",resolve:{currentAuth:["Auth",function(a){return a.auth.$requireAuth()}]}}).when("/user",{templateUrl:"views/user.html",controller:"UserCtrl",controllerAs:"user",resolve:{initData:["Auth","Vote","History","$q",function(a,b,c,d){var e,f=a.auth.$requireAuth(),g=[],h=[],i=[],j=c,k=d.defer();return d.when(f).then(function(a){e=a,j.all(e.uid).$loaded().then(function(a){angular.forEach(a,function(a){g.push(a.id),h.push(a.option)});for(var c=0;c<g.length;c++)b.ref.child(g[c]).once("value",function(a){var b=a.val(),d=h[c];i.push({id:g[c],title:b.title,date:b.date,option:b.options[d].content})});k.resolve({authData:e,listData:i})})}),k.promise}]}}).otherwise({redirectTo:"/list"})}]),angular.module("justVoteApp").controller("MainCtrl",["$scope","Auth","$location",function(a,b,c){a.isCollapsed=!0,a.Auth=b,a.Auth.auth.$onAuth(function(b){a.authData=b}),a.login=function(){return a.email&&a.passwd?void a.Auth.login(a.email,a.passwd).then(function(b){a.authData=b,c.path("/")})["catch"](function(b){console.log(b),a.error=b,a.passwd=""}):(a.error="Please provide your account information.",!1)},a.logout=function(b){a.Auth.logout(),c.path("/login"),b.preventDefault()}}]),angular.module("justVoteApp").controller("RegisterCtrl",["$scope","History","$location",function(a,b,c){a.history=b,a.create=function(){if(a.passwd1!=a.passwd2)return a.error="Password not match.",a.passwd1="",a.passwd2="",!1;var b=a.Auth.validUserInfo(a.email,a.passwd1);return b.state?void a.Auth.add(a.email,a.passwd1).then(function(b){a.userData=b,console.log("second step");var d={};d[a.userData.uid]=0,a.history.ref.update(d,function(){console.log("in callback"),c.path("/login")}),c.path("/login")})["catch"](function(b){a.error=b,a.passwd1="",a.passwd2=""}):(a.error=b.info,!1)}}]),angular.module("justVoteApp").controller("ListCtrl",["$scope","Vote","initData",function(a,b,c){a.selectPage=1,a.itemInput=3,a.itemPerPage=3,a.showLatest=!1,a.Vote=b,a.votes=c.listData,a.selected=function(b){a.selectPage=b},a.filterLatest=function(b){if(console.log(a.showLatest),a.showLatest){a.selectPage=1;var d=a.votes.slice(0,b);a.votes=[],a.votes=d}else a.selectPage=1,a.votes=c.listData},a.activate=function(b){return a.selectPage==b+1?"btn-activate":""}}]),angular.module("justVoteApp").controller("ItemCtrl",["$scope","Vote","History","initData","$q","$routeParams",function(a,b,c,d,e,f){console.log(d),d.exist?a.showResult=!0:a.showResult=null,a.disableSubmit=!0,a.selected=0,a.totalRate=0,a.voteId=f.id,a.uid=d.currentAuth.uid,a.history=c,a.vote=b.single(a.voteId),a.vote.$loaded().then(function(b){angular.forEach(b.options,function(b){a.totalRate=a.totalRate+b.rate})}),a.select=function(b){a.selected=b,console.log(a.selected),a.disableSubmit&&(a.disableSubmit=!a.disableSubmit)},a.submit=function(){e.defer();a.disableSubmit=!a.disableSubmit,a.vote.options[a.selected].rate++;var b=a.vote.$save(),c=a.history.add(a.uid,a.vote.$id,a.selected);e.all([b,c]).then(function(b){console.log(b[0].key()==a.vote.$id),a.totalRate=a.totalRate+1,console.log(b[1].key()+" vote is updated"),a.showResult=!0})}}]),angular.module("justVoteApp").controller("CreateCtrl",["$scope","currentAuth","Vote","$location",function(a,b,c,d){a.list=[{value:""},{value:""},{value:""}],a.uid=b.uid,a.vote=c,a.addOption=function(){a.list.push({value:""})},a.clear=function(){a.title="";for(var b=0;b<a.list.length;b++)a.list[b].value=""},a.submit=function(){if(!a.title)return a.error="Please type a title for the poll.",!1;for(var b=0;b<a.list.length;b++)if(!a.list[b].value)return a.error="Please fill all the blanks.",!1;for(var c=[],b=0;b<a.list.length;b++)c.push({content:a.list[b].value,rate:0});var e={creater:a.uid,title:a.title,options:c,date:(new Date).getTime()};a.vote.add(e).then(function(a){var b=a.key();console.log("new vote added, id: "+b),d.path("/list")})}}]),angular.module("justVoteApp").controller("UserCtrl",["$scope","initData",function(a,b){a.showLatest=!1,a.uid=b.authData.uid,a.records=b.listData,a.filterLatest=function(c){a.showLatest?a.records=a.records.slice(0,c):a.records=b.listData}}]),angular.module("justVoteApp").factory("Vote",["$firebaseObject","$firebaseArray","$q","firebaseUrl",function(a,b,c,d){var e=new Firebase(d+"/votes"),f=b(e);return{all:f,ref:e,add:function(a){return f.$add(a)},get:function(a){return f.$getRecord(a)},single:function(b){return a(e.child(b))},read:function(){return b(e).$loaded()}}}]),angular.module("justVoteApp").constant("firebaseUrl","https://popping-heat-1428.firebaseio.com"),angular.module("justVoteApp").factory("Auth",["$firebaseAuth","firebaseUrl",function(a,b){var c=new Firebase(b),d=a(c);return{auth:d,ref:c,login:function(a,b){return d.$authWithPassword({email:a,password:b})},logout:function(){return d.$unauth()},add:function(a,b){return d.$createUser({email:a,password:b})},validUserInfo:function(a,b){var c=/^[0-9a-z][_.0-9a-z-]{0,31}@([0-9a-z][0-9a-z-]{0,30}[0-9a-z]\.){1,4}[a-z]{2,4}$/;return c.test(a)?b.length<6?{state:!1,info:"Password must no shorter than 6 character."}:{state:!0,info:"correct"}:{state:!1,info:"Please input a correct email address."}}}}]),angular.module("justVoteApp").factory("History",["$firebaseArray","firebaseUrl",function(a,b){var c=new Firebase(b+"/history");a(c);return{ref:c,all:function(b){return a(c.child(b))},add:function(b,d,e){return a(c.child(b)).$add({date:(new Date).getTime(),id:d,option:e})}}}]),angular.module("justVoteApp").filter("total",function(){return function(a){var b=0,c=a.options;return angular.forEach(c,function(a){b+=a.rate}),b}}),angular.module("justVoteApp").filter("timeConvert",function(){return function(a){if(null==a)return"n/a";var b=(new Date).getTime(),c=b-a,d=Math.floor(c/864e5),e=Math.floor(c/36e5),f=Math.floor(c/6e4),g="Just now";return d>0?d+" days ago":e>0?e+" hours ago":f>1?f+" minutes ago":g}}),angular.module("justVoteApp").filter("range",["$filter",function(a){return function(b,c,d){if(angular.isNumber(c)&&angular.isNumber(d)){var e=(c-1)*d;return b.length<e?[]:a("limitTo")(b,d,e)}return b}}]),angular.module("justVoteApp").filter("pageCount",function(){return function(a,b){for(var c=[],d=0;d<Math.ceil(a.length/b);d++)c.push(d);return c}}),angular.module("justVoteApp").directive("routeLoadIndicator",["$rootScope",function(a){return{templateUrl:"views/loading-spanner.html",restrict:"E",link:function(b,c,d,e){b.isRouteLoading=!1,a.$on("$routeChangeStart",function(){b.isRouteLoading=!0}),a.$on("$routeChangeSuccess",function(){b.isRouteLoading=!1})}}}]),angular.module("justVoteApp").run(["$templateCache",function(a){a.put("views/create.html",'<div class="container"> <div class="row"> <div class="hidden-xs hidden-sm col-md-7 col-lg-7"> <h2>Initiate a Vote</h2> <h4>Just be curious how others think</h4> <div class="vote-img"> <img src="images/flat-icon/pencil-retina.fb058fc5.svg"> </div> </div> <div class="visible-sm-12 hidden-md hidden-lg welcome-title"> <h2>Initiate a Vote</h2> <h4>Just be curious how others think</h4> </div> <div class="col-xs-12 col-sm-12 col-md-5 col-lg-5"> <div class="panel panel-default panel-item panel-login"> <h5 class="login-title">Create <span class="pull-right"><span class="fui-plus"></span></span></h5> <div class="alert-login" ng-bind="error"></div> <div class="form-group" align="center"> <div class="input-group"> <span class="input-group-addon"><span class="fui-new"></span></span> <input type="text" class="form-control" placeholder="Title for your vote" ng-model="title"> </div> </div> <div class="form-group" id="marker" align="center" ng-repeat="item in list"> <div class="input-group"> <span class="input-group-addon"><span class="fui-radio-checked"></span></span> <input type="text" class="form-control" placeholder="Type an option" ng-model="item.value"> </div> </div> <div class="form-group" align="center"> <button type="button" class="btn btn-primary btn-lg btn-block btn-login" ng-click="addOption()">Add Option</button> </div> <div class="form-group" align="center"> <button type="button" class="btn btn-primary btn-lg btn-block btn-login" ng-click="clear()">Clear</button> </div> <div class="form-group" align="center"> <button type="button" class="btn btn-primary btn-lg btn-block btn-login" ng-click="submit()">Submit</button> </div> </div> </div> </div> </div>'),a.put("views/item.html",'<div class="container"> <div class="row row-title"> <div class="col-md-12 col-lg-12"> <h2>Vote It</h2> <h4>Choose and show your opinion</h4> </div> </div> <div class="row"> <div class="hidden-xs hidden-sm col-md-4 col-lg-3"> <div class="todo"> <div class="todo-search"> <strong>Navigator</strong> <span class="pull-right"><span class="fui-list-large-thumbnails"></span></span> </div> <ul> <li class="todo-done"> <div class="todo-content item-navigator"> <span class="fui-checkbox-checked"></span> <span> {{vote | total}} Attenders</span> </div> </li> <li class="todo-done item-navigator"> <div class="todo-content"> <span class="fui-time"></span> <span> {{vote.date | timeConvert}}</span> </div> </li> <li class="todo-done item-navigator"> <div class="todo-content"> <a type="button" ng-href="#/list" class="btn btn-primary"><span class="fui-arrow-left"></span>Back to list</a> </div> </li> </ul> </div> </div><!-- sidebar --> <div class="col-xs-12 col-sm-12 col-md-8 col-lg-9 item-content" ng-hide="showResult"> <h4 class="vote-item-title">{{vote.title}}</h4> <div class="panel-item panel-item-voted">Choose one of the following options.</div> <div ng-repeat="(key, value) in vote.options"> <input type="radio" value="{{key}}" name="item" ng-click="select(key)"><label class="option-label"> &nbsp;{{value.content}}</label> </div> <br> <button class="btn btn-primary btn-vote" ng-click="submit()" ng-disabled="disableSubmit"><span class="fui-check"></span>&nbsp;&nbsp;Vote</button> <hr> </div><!-- choose view --> <div class="col-xs-12 col-sm-12 col-md-8 col-lg-9 item-content" ng-show="showResult"> <h4 class="vote-item-title">{{vote.title}}</h4> <div class="panel-item panel-item-voted">You have voted. Thank you! Here is the review.</div> <div ng-repeat="(key, value) in vote.options"> <strong>{{value.content}}</strong> - {{value.rate}} out of {{totalRate}} <div class="progress"> <div class="progress-bar" role="progressbar" aria-valuenow="{{value.rate/totalRate*100}}" aria-valuemin="0" aria-valuemax="100" style="width: {{value.rate/totalRate*100}}%">{{value.rate/totalRate*100 | number:1}}%</div> </div> </div> </div><!-- result view --> </div><!-- row --> </div><!-- container -->'),a.put("views/list.html",'<div class="container"> <div class="row row-title"> <div class="col-md-12 col-lg-12"> <h2>Vote List</h2> <h4>Pick an item you interested</h4> </div> </div> <div class="row"> <div class="hidden-xs hidden-sm col-md-4 col-lg-3"> <div class="todo"> <div class="todo-search"> <strong>Filter</strong> <span class="pull-right"><span class="fui-gear"></span></span> </div> <ul> <li class="todo-done"> <div class="todo-content"> <span class="item-num-control">Total items: {{votes.length}}</span> </div> </li> <li class="todo-done"> <div class="todo-content"> <span class="item-num-control">Items per Page: {{itemPerPage}}</span> </div> </li> <li class="todo-done"> <div class="todo-content"> <span class="item-num-control">Current Page: {{selectPage}}</span> </div> </li> <li> <div class="todo-content"> <label class="checkbox" for="hideVoted"> <input type="checkbox" ng-model="showLatest" name="showLatest" ng-change="filterLatest(5)"> <strong>Show latest polls</strong> </label> </div> </li> </ul> </div> </div><!-- sidebar --> <div class="col-xs-12 col-sm-12 col-md-8 col-lg-9"> <div class="panel panel-default panel-item" ng-repeat="(key, value) in votes | range:selectPage:itemPerPage"> <div class="panel-body"> <h5 class="vote-title"><a ng-href="#/item/{{value.$id}}">{{value.title}}</a></h5> <p><small> <span class="fui-checkbox-checked"></span> <span>{{value | total}} Attended | </span> <span class="fui-time"></span> <span>{{value.date | timeConvert}}</span> <span class="fui-star-2 pull-right"></span> </small></p> </div> </div> <div class="btn-group"> <button ng-repeat="vote in votes | pageCount:itemPerPage" ng-click="selected($index + 1)" class="btn btn-primary">{{$index + 1}}</button> </div> </div><!-- main content --> </div><!-- row --> </div><!-- container -->'),a.put("views/loading-spanner.html",'<div class="sk-circle" ng-if="isRouteLoading"> <div class="sk-circle1 sk-child"></div> <div class="sk-circle2 sk-child"></div> <div class="sk-circle3 sk-child"></div> <div class="sk-circle4 sk-child"></div> <div class="sk-circle5 sk-child"></div> <div class="sk-circle6 sk-child"></div> <div class="sk-circle7 sk-child"></div> <div class="sk-circle8 sk-child"></div> <div class="sk-circle9 sk-child"></div> <div class="sk-circle10 sk-child"></div> <div class="sk-circle11 sk-child"></div> <div class="sk-circle12 sk-child"></div> </div>'),a.put("views/login.html",'<div class="container"> <div class="row"> <div class="hidden-xs hidden-sm col-md-7 col-lg-7"> <h2>Welcome, voter !</h2> <h4>Sign in and stand by what you like</h4> <div class="vote-img"> <img src="images/flat-icon/vote-retina.f0b98a67.svg"> </div> </div> <div class="visible-sm-12 hidden-md hidden-lg welcome-title"> <h2>Welcome, voter !</h2> <h4>Sign in and stand by what you like</h4> </div> <div class="col-xs-12 col-sm-12 col-md-5 col-lg-5"> <div class="panel panel-default panel-item panel-login"> <h5 class="login-title">Login <span class="pull-right"><span class="fui-user"></span></span></h5> <div class="alert-login" ng-bind="error" ng-show="error"></div> <div class="form-group" align="center"> <div class="input-group"> <span class="input-group-addon"><span class="fui-mail"></span></span> <input type="email" class="form-control" placeholder="E-Mail" ng-model="email"> </div> </div> <div class="form-group" align="center"> <div class="input-group"> <span class="input-group-addon"><span class="fui-lock"></span></span> <input type="password" class="form-control" placeholder="Password" ng-model="passwd"> </div> </div> <div class="form-group" align="center"> <button type="button" class="btn btn-primary btn-lg btn-block btn-login" ng-click="login()" ng-disabled="!(email&&passwd)">Login</button> </div> <p class="register-link" style="text-align: center">Not a voter?&nbsp;<a ng-href="#/register">Register</a></p> </div> </div> </div> </div>'),a.put("views/register.html",'<div class="container"> <div class="row"> <div class="hidden-xs hidden-sm col-md-7 col-lg-7"> <h2>Become a voter</h2> <h4>Toward the world of polls and votes</h4> <div class="vote-img"> <img src="images/flat-icon/loop-retina.c1fd935f.svg"> </div> </div> <div class="visible-sm-12 hidden-md hidden-lg welcome-title"> <h2>Become a voter</h2> <h4>Toward the world of polls and votes</h4> </div> <div class="col-xs-12 col-sm-12 col-md-5 col-lg-5"> <div class="panel panel-default panel-item panel-login"> <h5 class="login-title">Register <span class="pull-right"><span class="fui-plus-circle"></span></span></h5> <div class="alert-login" ng-bind="error" ng-show="error"></div> <div class="form-group" align="center"> <div class="input-group"> <span class="input-group-addon"><span class="fui-mail"></span></span> <input type="email" class="form-control" placeholder="Your E-Mail" ng-model="email"> </div> </div> <div class="form-group" align="center"> <div class="input-group"> <span class="input-group-addon"><span class="fui-lock"></span></span> <input type="password" class="form-control" placeholder="Choose a Password" ng-model="passwd1"> </div> </div> <div class="form-group" align="center"> <div class="input-group"> <span class="input-group-addon"><span class="fui-lock"></span></span> <input type="password" class="form-control" placeholder="Repeat your Password" ng-model="passwd2"> </div> </div> <div class="form-group" align="center"> <button type="button" class="btn btn-primary btn-lg btn-block btn-login" ng-click="create()" ng-show="email && passwd1 && passwd2">Register</button> </div> <p class="register-link" style="text-align: center">Already a voter?&nbsp;<a ng-href="#/login">Login</a></p> </div> </div> </div> </div>'),a.put("views/user.html",'<div class="container"> <div class="row row-title"> <div class="col-md-12 col-lg-12"> <h2>Vote History</h2> <h4>Review what you voted for</h4> </div> </div> <div class="row"> <div class="hidden-xs hidden-sm col-md-4 col-lg-3"> <div class="todo"> <div class="todo-search"> <strong>Filter</strong> <span class="pull-right"><span class="fui-gear"></span></span> </div> <ul> <li class="todo-done"> <div class="todo-content"> <label class="checkbox" for="showNew"> <input type="checkbox" ng-model="showLatest" name="showLatest" ng-change="filterLatest(5)"> <strong>Only show latest records</strong> </label> </div> </li> <li class="todo-done item-navigator"> <div class="todo-content"> <a type="button" ng-href="#/list" class="btn btn-primary"><span class="fui-arrow-left"></span>Back to list</a> </div> </li> </ul> </div> </div><!-- sidebar --> <div class="col-xs-12 col-sm-12 col-md-8 col-lg-9 history-wrapper"> <div class="well well-info"> <span class="fui-list-bulleted" style="color: #1ABC9C"></span> <span class="item-num-control">Total items: {{records.length}} </span> </div><!-- list info --> <div class="col-sm-12 col-md-6 col-lg-4 history-item" ng-repeat="record in records"> <div class="history-item-content"> <p><a ng-href="#/item/{{record.id}}" title="{{record.title}}">{{record.title}}</a></p> <span class="fui-checkbox-checked"></span><span> Your choice: {{record.option}}</span><br> <span class="fui-time"></span><span> {{record.date | timeConvert}}</span> </div> </div> <div class="col-sm-12 col-md-6 col-lg-4 history-item"> <div class="history-item-content history-add-item"> <p><a href="#/create" title="Initial a new vote">Initial a new vote</a></p> <span>&nbsp;</span><br> <span>&nbsp;</span> </div> </div> </div><!-- main content --> </div><!-- row --> </div><!-- container -->')}]);